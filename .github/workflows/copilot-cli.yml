# This is a basic workflow to help you get started with Actions

name: CI

# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the "main" branch
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # This workflow contains a single job called "build"
  build:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest
    permissions:
      contents: read

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - uses: actions/checkout@v5

      - name: 'Run Copilot with Custom Config'
        if: false
        uses: austenstone/copilot-cli@v1.0
        with:
          github-token: ${{ secrets.COPILOT_GITHUB_TOKEN }}
          prompt: |
            Review this pull request for:
            1. Code quality and best practices
            2. Security vulnerabilities
            3. Performance implications
            4. Documentation completeness
          mcp-config: |
            {
              "mcpServers": {
                "time": {
                  "command": "uvx",
                  "args": [
                    "mcp-server-time",
                    "--local-timezone",
                    "America/New_York"
                  ],
                  "tools": ["*"]
                }
              }
            }

      # Install Copilot CLI
      - name: Install Copilot CLI
        run: npm install -g @github/copilot

      # Interact with public repos
      - name: Public Repos
        run: |
          copilot -p "which public GitHub repos do I have access to?" --allow-all-tools
        env:
          COPILOT_GITHUB_TOKEN: ${{ secrets.COPILOT_GITHUB_TOKEN }}
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      # Interact with private repos
      - name: Private Repos
        run: |
          copilot -p "which private GitHub repos do I have access to?" --allow-all-tools
        env:
          COPILOT_GITHUB_TOKEN: ${{ secrets.COPILOT_GITHUB_TOKEN }}
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}